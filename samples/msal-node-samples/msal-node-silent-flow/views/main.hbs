<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Quickstart | MSAL Node.js Sample</title>
    
    <!-- adding Bootstrap 4 for UI components  -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="SHORTCUT ICON" href="https://c.s-microsoft.com/favicon.ico?v2" type="image/x-icon">
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
      <a class="navbar-brand" href="/">MS Identity Platform</a>
        {{#if showSignInButton}}
        <div class="ml-auto">
            <a type="button" id="SignIn" class="btn btn-secondary" href="/login" aria-haspopup="true" aria-expanded="false">
                Sign In
            </a>
        </div>
        {{/if}}
    </nav>
    <br>
    <h5 class="card-header text-center">MSAL Node.js demonstrating Silent Flow</h5>
    <br>
    <div class="row" style="margin:auto" >
    <div id="card-div" class="col-md-3">
    <div class="card text-center">
      <div class="card-body">
        {{#if showSignInButton}}
            <h5 class="card-title">Please sign-in to acquire a token silently</h5>
        {{else if acquiredToken}}
            <h5 class="card-title">Successfully acquired token for {{username}} using silent flow</h5>
            <button id="call-graph">Call MS Graph</button>
        {{else if couldNotAcquireToken}}
            <h5 class="card-title">Could not acquire token. Check console for more information.</h5>
        {{/if}}
        {{#if showATSButton }}
            <h5 class="card-title">Welcome, {{username}}, you have signed in successfully!</h5>
            <br>
            <br>
            <a class="btn btn-primary" id="seeProfile" href="/silentFlow">Acquire Token Silent</a>
        {{/if}}
      </div>
    </div>
    </div>
    <br>
    <br>
      <div class="col-md-4">
        <div class="list-group" id="list-tab" role="tablist">
        </div>
      </div>
      <div class="col-md-5">
        <div class="tab-content" id="nav-tabContent">
            <pre id="graph-data"></pre>
        </div>
      </div>
    </div>
    <br>
    <br>

    <script type="text/javascript">
        const graphData = document.querySelector("#graph-data");
        const callGraphButton = document.querySelector("#call-graph");
        if (callGraphButton) {
            callGraphButton.addEventListener("click", e => {
                fetch("/me")
                    .then(response => response.json())
                    .then(data => {
                        console.log(data);
                        graphData.innerHTML = JSON.stringify(data, null, 4);
                    })
                    .catch(error => {
                        console.error(error);
                    })
            })
        }
    </script>
  </body>
</html>
